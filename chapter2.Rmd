# Chapter 2: Regression and model validation 

*Describe the work you have done this week and summarize your learning.*

- Describe your work and results clearly. 
- Assume the reader has an introductory course level understanding of writing and reading R code as well as statistical methods.
- Assume the reader has no previous knowledge of your data or the more advanced methods you are using.


**In this chapter we will explore the dataset from *http://www.helsinki.fi/~kvehkala/JYTmooc/JYTOPKYS3-data.txt*, looking first closer at the dataframe and afterwards visualize some
interesting features.**

## Data wrangling 
**REMARK: This part is in principle the same as the code executed in the .R file in the data-folder. Still, I would like to include the main points in the diary so that one can see the development from the original dataset to the analysed subset.**

### Looking at the original dataset


First let's read in the full learning2014 data as a dataframe from the given website.
```{r}
lrn14 <- read.table("http://www.helsinki.fi/~kvehkala/JYTmooc/JYTOPKYS3-data.txt", sep="\t", header=TRUE)
head(lrn14)
```
Only looking at the head of the dataframe makes it quite visible that some data wrangling will help in understanding the data better. 


As a next step, let's look at
the *structure* and *dimensions*. Printing all of it would make the report confusing, so I am using ***eval=FALSE*** to not run the code and write the results instead as a comment into the R chunk.
```{r, eval=FALSE}
dim(lrn14) # The dataframe consists of 183 observations and 60 variables.
str(lrn14) # 59 variables are of the data type "integer" and 1 (gender) of the type "character"
```


### Preparing an analysis sub dataset for further data exploration
For this we have to include the library *dplyr* (***library(dplyr)***) which is a common R library used for data wrangling
```{r,message=FALSE}
library(dplyr)
```

**Combining question variables**
```{r}
deep_questions <- c("D03", "D11", "D19", "D27", "D07", "D14", "D22", "D30","D06",  "D15", "D23", "D31")
surface_questions <- c("SU02","SU10","SU18","SU26", "SU05","SU13","SU21","SU29","SU08","SU16","SU24","SU32")
strategic_questions <- c("ST01","ST09","ST17","ST25","ST04","ST12","ST20","ST28")
```

**Combining columns and add a weighted column to the dataset**
```{r}
deep_columns <- select(lrn14, one_of(deep_questions))
surface_columns <- select(lrn14, one_of(surface_questions))
strategic_columns <- select(lrn14, one_of(strategic_questions))
```

**Create a new sub dataframe**

Using the ***head()*** function the output gives us the first 6 rows of the subset.
```{r}
# create the df subsect
df_subset <- c("gender","Age","Points")
learning2014 <- select(lrn14,one_of(df_subset))
learning2014$attitude= lrn14$Attitude/10
learning2014$deep <- rowMeans(deep_columns)
learning2014$stra <- rowMeans(strategic_columns)
learning2014$surf <- rowMeans(surface_columns)
head(learning2014)
```
**Do some reformatting and scaling of attitude value**

We want to have the points in the end and all the variable to be lowercase. Furthermore, as the *attitude* variable is also a combined value based on 10 questions it will be divided by 10.
```{r}

# change the name of the second column
colnames(learning2014)[2] <- "age"
# change the name of "Points" to "points"
colnames(learning2014)[3] <- "points"
# reorder the dataframe
learning2014 <- learning2014[c(1,2,4,5,6,7,3)] 
head(learning2014)
```
## Data analysis
### Looking at the new data subset
**Reading in the data from a .csv created in the project subfolder**

First let's use ***read.csv()*** or ***read.table()*** to read in the data subset created before and display the head of it.
```{r, results='hide'}
students2014 <- read.csv("./data/learning2014.csv", header = TRUE, sep = ",")
students2014b <- read.table("./data/learning2014.txt", sep = "\t", header = TRUE)
```

```{r}
head(students2014)
```

**Structure and dimension of the subset**
```{r}
dim(students2014)
str(students2014)

```
This sub dataset consists of 7 variables (which were defined above) and 183 observations. The datatypes consist of 4 *numerical* type variables which give us the grade that the 
students obtained in the respective categories in the scale (0-5), 2 *integer* type variables giving the age and the points, and one *character* type variable stating the gender.

**Getting rid of 0 values**
```{r}
# select rows where points is greater than zero
students2014 <- filter(students2014, points > 0) 
students2014b <- filter(students2014b, points > 0) 
dim(students2014)

```
As one can see we have $183-166=17$ rows with 0 points, so students not taking the final exam.

### Visualizations
**Graphical overview of the data**


```{r}
library(ggplot2)
library(GGally)
# create a plot matrix with ggpairs()
ggpairs(students2014, mapping = aes(col = gender, alpha = 0.3), lower = list(combo = wrap("facethist", bins = 20)))
summary(students2014)
```

### Regression model
From the pairs plot above let's choose the 3 variables with highest correlation to points as explanatory variables to be used for the regression model. The exam points
will then be our target variable: **exam points ~ x1 + x2 + x3**. The respective variables would be *attitude*, *stra* and *surf*.
**Further description and interpretation will still be added.**
```{r}
# create a regression model with multiple explanatory variables
my_model <- lm(points ~ attitude + stra + surf, data = students2014)
summary(my_model)
```

```{r}
my_model2 <- lm(points ~ attitude + stra, data = students2014)
summary(my_model2)
```

```{r}
my_model3 <- lm(points ~ attitude, data = students2014)
summary(my_model3)
```

### Diagnostics plot
```{r}
#par(mfrow = c(2,2)) #To put the images in the same figures. However, I prefer them a bit bigger right now.
plot(my_model2, which=c(1,2,5))
```
**Description and interpretation will still be added.**